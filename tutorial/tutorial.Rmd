---
title: "RNODE"
author: "Daniel YM Nakamura, Ward Wheeler, Taran Grant"
date: "5 November 2025"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Preamble

Tutorial to demonstrate the main functions available in the R package \code{RNODE}. This tutorial is organized in two sections related to preprocessing and post-processing of phylogenetic trees.

```{r warning=F, message=F}
# Set the working directory 
knitr::opts_knit$set(root.dir = "/Users/labanfibios/Desktop/Doutorado/Project/B5_RNODE/RNODE/tutorial/")

# Load the package
library(ggplot2)
library(RNODE)
```

# 2. Example 1: Comparison of support values between trees

## 2.1 Simulated data

Comparisons between phylogenetic trees are usually performed using topological distance metrics (e.g. Robinson-Foulds and SPR distances) but comparisons of support values between corresponding nodes are usually neglected. We propose the function **sharedNodes** to create a dataframe with node labels, descendants, and support values of shared clades between two phylogenetic trees, which facilitates descriptive and statistical comparisons of support values between corresponding nodes. Two examples are provided below.

First, we can demonstrate this function using two simulated trees with the same composition of terminals but different topologies. Notice that *composition = T* will show the composition of each clade in the output dataframe.

```{r}
# Simulate two trees
set.seed(44)
a = pbtree(n=7) # initial tree a
node_labels = sample(1:100, a$Nnode, replace = TRUE) # generate random node labels as integers to tree a
a$node.label = node_labels # add the node labels to tree a
set.seed(88)
b = pbtree(n=7) # initial tree b
node_labels = sample(1:100, b$Nnode, replace = TRUE) # Generate random node labels as integers to tree a
b$node.label = node_labels # Set the node labels to tree b

# Visualize trees
#layout(c(1,2))
#plotTree(ladderize(a, right = T),node.numbers=T, color="blue")
#nodelabels(a$node.label,
#           adj=c(1.9, 1.7), # horizontal and vertical position
#           frame="none")
#plotTree(ladderize(b, right = T),node.numbers=T, color="red")
#nodelabels(b$node.label,
#           adj=c(2, 1.7), # horizontal and vertical position
#           frame="none")

# Run 
df = sharedNodes(tree1=a, tree2=b, composition=T, 
                 plotTrees = T,
                 output.tree1="example1.1_simulated1.pdf",
                 output.tree2="example1.1_simulated2.pdf", 
                 tree.width = 3, # adjust tree width
                 tree.height = 4, # adjust tree height
                 tree.fsize = 1, # adjust font size
                 tree.adj=c(1.2,3), # adjust support position
                 tree.cex=.5, # adjust support size
                 node.numbers=F) # show node index
```

In contrast to **compareNodes**, the list of descendants and support values of unique clades from each tree can be assessed using **uniqueNodes**.

```{r}
uniqueNodes(a, b, composition=T, dataframe=T,
            plotTrees=T, output.tree = "example1.1_unique.pdf",
            node.numbers=F, # show node index
            tree.fsize=2, # adjust text size
            tree.cex=3.5, # adjust circle size
            sup.adj1=c(-.2,4), # adjust support from tree a
            sup.adj2=c(1.3,4) # adjust support from tree b
            )
```

## 2.2 Empirical data

We can use **sharedNodes** to compare two empirical trees in .nwk format estimated in TNT. One tree was estimated with Sanger-based data, whereas the other one was estimated with AHE data. Polytomies and input trees with different taxon samples are accepted but names of corresponding leaves should be equal in the input trees.

For instance, we can plot the relationship between molecular and total evidence trees analyzed in IQ-TREE by Whitcher et al. (2024).

```{r}
# Load trees
MOL = read.tree("../testdata/Whitcher2024_ML_MOL.contree")
TE = read.tree("../testdata/Whitcher2024_ML_TE.contree")

# Run sharedNodes
df = sharedNodes(tree1=MOL, 
                 tree2=TE)

# Plot the relationship of support between trees
ggplot(df, aes(as.numeric(Support_Tree_1), as.numeric(Support_Tree_2))) +
  geom_point(size = 5, show.legend = F, alpha=.5) +
  theme_minimal() + 
  labs(x="\nSupport of Tree 1",
       y="Support of Tree 2\n")

View(df)
```

As expected, there is a denser concentration of shared clades with higher values of support, whereas only a few poorly supported clades are shared by both trees.









# 3. Comparison of DNA sequences

# 4. Manipulation of matrices

## 4.2 splitOrdFromUnord: Split a Nexus morphological matrix into partitions of ordered and unordered characters

```{r}
# Data input of list of ordered characters
setwd("../../../B2_TEvsMOL/Other/OLD/048_Fossils/iqtree/")

list_ordered=c(1, 6, 7, 8, 10, 12, 13, 14, 17, 19, 23, 26, 31, 35, 41, 44, 45, 48, 51, 54, 55, 68, 71, 72, 92, 94, 96, 102, 105, 108, 109, 128, 129, 130, 131, 132, 135, 142, 144, 152, 153, 193)

RNODE::splitOrdFromUnord(input="048_MORPH_data.nex", output_index = "048_MORPH", list_ordered, invariant = F)
```

# 5. Manipulation of trees

# 6. References

Ruane, S., Raxworthy, C. J., Lemmon, A. R., Lemmon, E. M., & Burbrink, F. T. (2015). Comparing species tree estimation with large anchored phylogenomic and small Sanger-sequenced molecular datasets: an empirical study on Malagasy pseudoxyrhophiine snakes. BMC Evolutionary Biology, 15, 1-14.

Whitcher (ADICIONAR)
